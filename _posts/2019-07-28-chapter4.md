---
title: "Direct3D의 초기화"
date: 2019-07-28T10:33:00-04:00
categories:
  - directX 12
tags:
  - study
---

## Direct3D의 초기화

### COM(Component Object Model)
DirectX의 프로그래밍 언어 독립성과 하위 호환성을 가능하게 하는 기술

직접 생성할 일 없고 COM 인터페이스를 가리키는 포인터를 얻어서 사용한다.

사용 후에는 Relaeas 메서드를 호출하여 해제해야한다.

COM 객체는 참조 횟수가 0이 되면 메모리에서 해제된다.

WRL::ComPtr, 스마트 포인터

범위를 벗어난 ComPtr 인스턴스는 자동으로 Release를 호출한다.

Get, GetAddressOf, Reset 함수만을 사용해도 충분

COM 인터페이스들은 이름이 대문자 I(i)로 시작한다.

## 텍스처 형식

## 교환사슬

전면버퍼, 후면버퍼

제시(presenting): 전면 버퍼와 후면버퍼의 역할을 교환해서 페이지가 전환되게 하는 것

전환 시에는 포인터만 맞바꾸면 된다.

IDXGISwapChain: 교환 사슬을 대표하는 인터페이스

## 깊이 버퍼링, z-버퍼링
깊이 정보를 담은 깊이 버퍼를 이용하여 그리는 순서와 무관하게 가리는 물체를 판정하여 그릴수 있다.

## 자원
렌더링 파이프 라인에 자원을 바인딩하여 렌더링을 한다.

실제로 바인딩 되는것은 자원을 참조하는 서술자이다.(범용적으로 사용하기 위해)

GPU는 자원의 형식을 알 수 없다.

## 서술자
자원을 GPU에 서술하는 수단

서술자를 이용하여 자원의 형식을 명시할 수 있다.

CBV/SRV/UAV 서술자들은 상수버퍼, 셰이더 자원, 순서 없는 접근을 서술

표본추출기 서술자는 텍스처 적용에 쓰이는 표본추출기 자원을 서술

RTV 서술자는 렌더 대상 자원을 서술

DSV 서술자는 깊이/스텐실 자원을 서술

## 서술자 힙(descriptor heap)

## 다중표본화

안티앨리어싱

초과표본화: 버퍼를 화면 해상도보다 4배 크게 잡고 렌더링 화면에 출력할때는 원래 크기로 환원하여 사용, 하향 표본화라고도 함

다중표본화는 부분픽셀을 이용, 4배 크게 하는건 같지만 픽셀의 중심에서 계산하여 최종 색상 결정

ID3D12Device::CheckFeatureSupport를 이용하여 텍스처 형식과 표본 개수의 조합에 대한 품질 수준들의 개수를 알수 있다.

## 기능수준

## DXGI(DirectX Graphics Infrastructure)
전체 화며 모드전환, 디스플레이 어댑터나 모니터, 지원되는 디스플레이 모드 같은 그래픽 시스템정보의 열거 등의 기능 제공

IDXGIFactory 인터페이스: IDXGISwapChain 인터페이스 생성, 디스플레이 어댑터 열거에 사용

## 상주성

## CPU명령 목록, GPU 명령대기열
명령 대기열이 비면 GPU는 할일이 없고, 대기열이 꽉 차면 GPU가 명령들을 처리하여 대기열에 자리가 생길 때까지 CPU가 놀게 된다.

명령 대기열을 대표하는 인터페이스 ID3D12CommandQueue

ID3D12CommandQueue::ExecuteCommandLists 명령 목록에 있는 명령을 대기열에 추가하는 메서드

ID3D12GraphicsCommandList::Close 명령 목록 닫기 메서드, 명령 목록을 제출하기 전에 먼저 닫아줘야 함

ID3D12Device::CreateCommandAllocator 명령 메모리 할당자 생성 메서드

ID3D12Device::CreateCommandList 명령 목록 생성 메서드

명령들을 여러 명령 목록에 동시에 기록할 수는 없으며 현재 명령들을 추가하는 명령 목록을 제외한 모든 명령 목록은 닫혀있어야한다.

GPU가 명령 할당자에 담긴 모든 명령을 실행했음이 확실해지기 전까지는 명령 할당자를 재설정하면 안된다.

## CPU/GPU 동기화

## 자원 상태 전이
자원에 상태를 부여하여 자원 위험 상황을 해결

자원 위험 상황: GPU가 자원에 자료를 다 기록하지 않았거나 기록을 시작하지 않은 상태에서 자원의 자료를 읽으려하는 문제

## Direct3D 초기화 과정
1. D3D12CreateDevice 함수를 이용해서 ID3D12Device를 생성
2. ID3D12Fence 객체를 생성하고 서술자들의 크기를 얻는다.
3. 4X MSAA 품질 수준 지원 여부를 점검
4. 명령 대기열과 명령 목록 할당자, 그리고 주 명령 목록을 생성
5. 교환 사슬을 서술하고 생성
6. 응용 프로그램에 필요한 서술자 힙들을 생성
7. 후면 버퍼의 크기를 설정하고, 후면 버퍼에 대한 렌더 대상 뷰를 생성
8. 깊이/스텔실 버퍼를 생성하고, 그와 연관된 깊이/스텐실 뷰를 생성
9. 뷰포트와 가위 판정용 사각형들을 설정

## 장치 생성
